!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).track=e()}(this,(function(){"use strict";const t=require("axios").create({mode:"cors",headers:{"Access-Control-Allow-Headers":"Content-Type","Content-Type":"application/json"}});return class{constructor(t={}){this.config=t,this.trackList=[]}init(){console.log(1),console.log(999),this.domEvent()}domEvent(){console.log(555),document.getElementsByTagName("body")[0].addEventListener("click",t=>{const e=t.target,{dataset:a}=e;let{track:o,extra:n="{}"}=a;e&&1===e.nodeType&&"function"==typeof e.onclick&&o&&(n&&(n=JSON.parse(n)),n.btn_text=e.innerText,this.tcFnc({name:o,extra:n,type:"click"}))})}tcFnc(t){t="string"==typeof t?{name:t,extra:{},type:"click"}:Object.assign({name:"",extra:{},type:"click"},t),this.saveStrackData(t)}saveStrackData(t){const{project:e,extraBasic:a,version:o,extraEvent:n,threshold:s,trackUrl:c}=this.config,r={project:e},i=this.getUrlParams(),l=this.getCookieParams();t.extra=Object.assign({extraEvent:n},{urlData:i},{cookieData:l});const h={client_time:+new Date,event_category:t.type,referer:document.referrer||"",location:document.location.pathname,target:t.name,extra:t.extra||{}},d={};d.basic_info=Object.assign(r,a),this.trackList.push(h),d.event_list=this.trackList,d.version=o,this.trackList.length>=s&&fetch&&this.postTrackData(c,d)}getUrlParams(){var t,e,a="undefined"!=typeof document&&document.location.search.length>0?document.location.search.substring(1):"",o=a.length>0?a.split("&"):[],n={},s={};for(t=0,e=o.length;t<e;t++){var c=o[t].split("=");n[c[0]]=c[1]}return s=Object.assign(s,n)}getCookieParams(){var t,e,a="undefined"!=typeof document&&document.cookie,o={},n={};if(!a||""===a)return o;for(t=0,e=(a=a.split("; ")).length;t<e;t++){var s=a[t].split("=");n[s[0]]=s[1]}return o=Object.assign(o,n)}postTrackData(e,a){t({method:"post",url:e,data:a}).then((function(t){if(200===t.status&&0===t.data.code)console.log("Success:",t),this.trackList=[];else{this.postTrackDataAgain(e,a);const t={...a};t.name=`${this.connfig.project}_error_track_data`,this.postTrackDataAgain(e,t)}})).catch((function(t){console.error("Error:",t),this.trackList=[]}))}postTrackDataAgain(e,a){t({method:"post",url:e,data:a}).then((function(t){if(200===t.status&&0===t.data.code)console.log("Success:",t),this.trackList=[];else{this.postTrackDataAgain(e,a);const t={...a};t.name=`${this.connfig.project}_error_track_data`,this.postTrackDataAgain(e,t)}})).catch((function(t){console.error("Error:",t),this.trackList=[]}))}}}));

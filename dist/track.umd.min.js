!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).track=e()}(this,(function(){"use strict";const t=require("axios").create({mode:"cors",headers:{"Access-Control-Allow-Headers":"Content-Type","Content-Type":"application/json"}});return class{constructor(t={}){this.config=t,this.trackList=[]}init(){console.log(999),this.domEvent()}domEvent(){this.isBrower()&&document.getElementsByTagName("body")[0].addEventListener("click",t=>{const e=t.target,{dataset:a}=e;let{track:s,extra:r="{}"}=a;e&&1===e.nodeType&&"function"==typeof e.onclick&&s&&(console.log(s),r&&(r=JSON.parse(r)),r.btn_text=e.innerText,this.tcFnc({name:s,extra:r,type:"click"}))})}tcFnc(t){t="string"==typeof t?{name:t,extra:{},type:"click"}:Object.assign({name:"",extra:{},type:"click"},t),this.saveStrackData(t)}saveStrackData(t){const{extraEvent:e,threshold:a}=this.config,s=this.isBrower(),r=this.getUrlParams(),o=this.getCookieParams();t.extra=Object.assign({extraEvent:e},{urlData:r},{cookieData:o});const n={client_time:+new Date,event_category:t.type,referer:s?document.referrer:"",location:s?document.location.pathname:"",target:t.name,extra:t.extra||{}};this.trackList.push(n),console.log(this.trackList),this.trackList.length>=a&&this.postTrackData()}getUrlParams(){let t="";this.isBrower()&&(t=document.location.search.length>0?t.substring(1):"");var e,a,s=t.length>0?t.split("&"):[],r={},o={};for(e=0,a=s.length;e<a;e++){var n=s[e].split("=");r[n[0]]=n[1]}return o=Object.assign(o,r)}getCookieParams(){let t="";this.isBrower()&&(t=document.cookie);var e,a,s={},r={};if(!t||""===t)return s;for(e=0,a=(t=t.split("; ")).length;e<a;e++){var o=t[e].split("=");r[o[0]]=o[1]}return s=Object.assign(s,r)}postTrackData(){const{trackUrl:e,extraBasic:a,version:s,project:r}=this.config,o={project:r},n={};n.basic_info=Object.assign(o,a),n.event_list=this.trackList,n.version=s,t({method:"post",url:e,data:n}).then(t=>{if(200===t.status&&0===t.data.code)console.log("Success:",t),this.trackList=[];else{this.postTrackDataAgain(e,n);const t={...n};t.name=`${this.connfig.project}_error_track_data`,this.postTrackDataAgain(e,t)}}).catch(t=>{console.error("Error:",t),this.trackList=[]})}postTrackDataAgain(e,a){t({method:"post",url:e,data:a}).then((function(t){if(200===t.status&&0===t.data.code)console.log("Success:",t),this.trackList=[];else{this.postTrackDataAgain(e,a);const t={...a};t.name=`${this.connfig.project}_error_track_data`,this.postTrackDataAgain(e,t)}})).catch((function(t){console.error("Error:",t),this.trackList=[]}))}isBrower(){return"undefined"!=typeof document}}}));
